<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>server side on Blackdiz's Garage</title><link>https://blackdiz.github.io/tags/server-side/</link><description>Recent content in server side on Blackdiz's Garage</description><generator>Hugo -- gohugo.io</generator><language>zh-TW</language><lastBuildDate>Tue, 06 Jul 2021 01:28:39 +0800</lastBuildDate><atom:link href="https://blackdiz.github.io/tags/server-side/index.xml" rel="self" type="application/rss+xml"/><item><title>Use FreeMarker Template to Output JSON</title><link>https://blackdiz.github.io/blog/freemarker-json/</link><pubDate>Tue, 06 Jul 2021 01:28:39 +0800</pubDate><guid>https://blackdiz.github.io/blog/freemarker-json/</guid><description>Use FreeMarker Template to Output JSON é¦–å…ˆæˆ‘å€‘å…ˆæº–å‚™ä¸€å€‹ FreeMarker çš„ template: test.fltj, fltj æ˜¯æˆ‘å€‘è‡ªå‰µçµ¦ JSON æ ¼å¼ tempalte çš„å‰¯æª”å:
{ &amp;#34;name&amp;#34;: &amp;#34;test&amp;#34;, ${content} } ${content} å°±æ˜¯æˆ‘å€‘ç­‰æœƒå…’è¦å‹•æ…‹è¨­ç½®çš„éƒ¨åˆ†ã€‚
æ¥è‘—æˆ‘å€‘éœ€è¦å»ºç«‹ FreeMarker çš„ Configruationï¼Œé€™å€‹ Configuration ç†è«–ä¸Šåªéœ€è¦å»ºç«‹ä¸€å€‹ï¼š
Configuration configuration = new Configuration(Configuration.VERSION_2_3_25); // é€™è£¡è¨­å®š JSON ç¯„æœ¬çš„è·¯å¾‘ configuration.setClassForTemplateLoading(this.getClass(), &amp;#34;/templates/json-templates&amp;#34;); configuration.setDefaultEncoding(&amp;#34;UTF-8&amp;#34;); configuration.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER); configuration.setLogTemplateExceptions(false); ç„¶å¾Œæˆ‘å€‘ä½¿ç”¨ jackson é€™å€‹ library ä¾†å¹«æˆ‘å€‘æŠŠ Java ç‰©ä»¶è½‰æˆ JSON æ ¼å¼çš„å­—ä¸²ï¼š
Map&amp;lt;String, Object&amp;gt; data = new HashMap&amp;lt;&amp;gt;(); data.put(&amp;#34;text&amp;#34;, &amp;#34;test message&amp;#34;); data.put(&amp;#34;age&amp;#34;, 23); data.put(&amp;#34;boolean&amp;#34;, true); ObjectMapper mapper = new ObjectMapper(); // writerWithDefaultPrettyPrinter() æœƒæ’ç‰ˆè¼¸å‡ºçš„çµæœ String jsonString = mapper.</description></item><item><title>å¾ Server ç«¯è¼¸å‡ºä¸‹è¼‰çš„æª”åå«æœ‰ä¸­æ–‡æœƒè®Šæˆäº‚ç¢¼å•é¡Œ</title><link>https://blackdiz.github.io/blog/garbled-file-name/</link><pubDate>Mon, 22 Mar 2021 15:15:46 +0800</pubDate><guid>https://blackdiz.github.io/blog/garbled-file-name/</guid><description>å¾ Server ç«¯è¼¸å‡ºä¸‹è¼‰çš„æª”åå«æœ‰ä¸­æ–‡æœƒè®Šæˆäº‚ç¢¼å•é¡Œ æœ‹å‹é‡åˆ°ä¸€å€‹å•é¡Œæ˜¯å¦‚æœæª”åæœ‰ä¸­æ–‡ï¼Œåœ¨ç€è¦½å™¨ä¸‹è¼‰æ™‚æª”åæœƒè®Šæˆäº‚ç¢¼ã€‚
é¦–å…ˆï¼Œç€è¦½å™¨æ˜¯ç”¨ header ä¸­çš„ Content-Disposition=attachment;filename=${æª”å} åšç‚ºé è¨­çš„ä¸‹è¼‰æª”åï¼Œä½† header ä¸­ä¸¦ä¸æ”¯æ´ UTF-8 ç·¨ç¢¼ï¼Œæ‰€ä»¥å¦‚æœåœ¨ç¨‹å¼ä¸­ç›´æ¥æ‹¿ä¸­æ–‡æª”åæ”¾åœ¨ filename ä¸­å°±æœƒè®Šæˆäº‚ç¢¼ã€‚
è§£æ±ºæ–¹æ³•æ˜¯å…ˆæŠŠæª”å encode æˆ URL-encoded ç·¨ç¢¼ï¼Œåœ¨ Java ä¸­å¯ä»¥ç”¨ URLEncoder è™•ç†ï¼š
response.setHeader(&amp;#34;Content-Disposition&amp;#34;, &amp;#34;attachment;filename=&amp;#34; + URLEncoder.encode(fileName, &amp;#34;UTF-8&amp;#34;); å¦‚æœæœ‰ä»€éº¼æƒ³æ³•æˆ–éœ€è¦æŒ‡æ­£çš„åœ°æ–¹ï¼Œæ­¡è¿æ‚¨ç•™è¨€æˆ–ä¾†ä¿¡ ğŸ˜„</description></item></channel></rss>