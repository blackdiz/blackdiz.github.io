<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>java on Blackdiz's Garage</title><link>https://blackdiz.github.io/tags/java/</link><description>Recent content in java on Blackdiz's Garage</description><generator>Hugo -- gohugo.io</generator><language>zh-TW</language><lastBuildDate>Sun, 11 Jul 2021 23:58:09 +0800</lastBuildDate><atom:link href="https://blackdiz.github.io/tags/java/index.xml" rel="self" type="application/rss+xml"/><item><title>Java: Compartion Violation å•é¡Œå°è¨˜</title><link>https://blackdiz.github.io/blog/compartion-violation/</link><pubDate>Sun, 11 Jul 2021 23:58:09 +0800</pubDate><guid>https://blackdiz.github.io/blog/compartion-violation/</guid><description>å‰é™£å­å’Œæœ‹å‹è¨è«–ä¸€å€‹å¥‡å¦™çš„éŒ¯èª¤è¨Šæ¯ï¼Œèªªåœ¨åŸ·è¡Œ Collections.sort(list) æ™‚æœƒå‡ºç¾ã€‚ç¬¬ä¸€çœ¼çœ‹åˆ°é€™å€‹éŒ¯èª¤è¨Šæ¯ï¼Œè…¦ä¸­åªå†’å‡ºç„¡é™å¤šå€‹å•è™Ÿï¼Œå¿ƒä¸­åªæœ‰ OSï¼šã€Œé€™äº›å·¥ç¨‹å¸«ä»€éº¼æ™‚å€™æ‰èƒ½å¥½å¥½èªªå¥äººè©±&amp;hellip;ã€(è©±èªªä½ è‡ªå·±ä¸ä¹Ÿæ˜¯å·¥ç¨‹å¸«å˜›)ï¼Œæ²’è¾¦æ³•åªå¥½è«‹å‡º Google å¤§ç¥ï¼Œèª°å«æˆ‘å€‘éƒ½æ˜¯ Google å·¥ç¨‹å¸«å˜›ã€‚
åŸä¾†åœ¨ JDK 1.7 å¾Œå¼•å…¥äº† Tim Sort é€™å€‹æ’åºæ³•ï¼ŒTim Sort æ˜¯ Merge Sort çš„è®Šå‹ä½†æ›´æœ‰æ•ˆç‡ï¼Œè‡³æ–¼ Tim Sort å’Œ Merge Sort å…·é«”çš„æ’åºç´°ç¯€ç‚ºä½•å‰‡ä¸åœ¨æœ¬æ–‡ç¯„åœå…§(å…¶å¯¦æ˜¯æˆ‘è‡ªå·±ä¹Ÿé‚„æ²’ææ¸…æ¥š Tim Sortâ€¦)ã€‚ é›–ç„¶æ¯”è¼ƒæœ‰æ•ˆç‡ï¼Œä½†å°æ–¼æ’åºæ™‚å¦‚ä½•æ¯”è¼ƒè¢«æ’åºå…ƒç´ å¤§å°çš„é‚è¼¯æ­£ç¢ºæ€§å°±æ›´è¦æ±‚ï¼Œè¦èƒ½ä½¿ç”¨ Collections.sort çš„å…ƒç´ å¿…é ˆå¯¦ä½œ Comparable çš„ toCompare methodï¼Œæ ¹æ“š API èªªæ˜ï¼Œå¯¦ä½œ compareTo æ™‚ï¼Œæ¯”è¼ƒå…ƒç´ å¤§å°çš„é‚è¼¯å¿…é ˆç¬¦åˆä¸‹åˆ—åŸå‰‡ï¼š
ç›¸åæ€§ï¼š A &amp;gt; B æ™‚ï¼Œå¿…é ˆç¬¦åˆ -A &amp;lt; B éå»¶æ€§ï¼šA &amp;gt; B ä¸” B &amp;gt; C æ™‚ï¼Œå¿…é ˆç¬¦åˆ A &amp;gt; C å¿…é ˆç¬¦åˆ A == B æ™‚ï¼ŒA == C ä¸” B == C å¦‚æœæœ‰é•åé€™ 3 å€‹åŸå‰‡çš„è©±ï¼Œæœ‰å¯èƒ½æœƒåœ¨æ’åºéç¨‹ä¸­æ‹‹å‡º IllegalArgumentException: Comparison method violates its general contract!</description></item><item><title>Use FreeMarker Template to Output JSON</title><link>https://blackdiz.github.io/blog/freemarker-json/</link><pubDate>Tue, 06 Jul 2021 01:28:39 +0800</pubDate><guid>https://blackdiz.github.io/blog/freemarker-json/</guid><description>Use FreeMarker Template to Output JSON é¦–å…ˆæˆ‘å€‘å…ˆæº–å‚™ä¸€å€‹ FreeMarker çš„ template: test.fltj, fltj æ˜¯æˆ‘å€‘è‡ªå‰µçµ¦ JSON æ ¼å¼ tempalte çš„å‰¯æª”å:
{ &amp;quot;name&amp;quot;: &amp;quot;test&amp;quot;, ${content} } ${content} å°±æ˜¯æˆ‘å€‘ç­‰æœƒå…’è¦å‹•æ…‹è¨­ç½®çš„éƒ¨åˆ†ã€‚
æ¥è‘—æˆ‘å€‘éœ€è¦å»ºç«‹ FreeMarker çš„ Configruationï¼Œé€™å€‹ Configuration ç†è«–ä¸Šåªéœ€è¦å»ºç«‹ä¸€å€‹ï¼š
Configuration configuration = new Configuration(Configuration.VERSION_2_3_25); // é€™è£¡è¨­å®š JSON ç¯„æœ¬çš„è·¯å¾‘ configuration.setClassForTemplateLoading(this.getClass(), &amp;#34;/templates/json-templates&amp;#34;); configuration.setDefaultEncoding(&amp;#34;UTF-8&amp;#34;); configuration.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER); configuration.setLogTemplateExceptions(false); é€™è£¡æˆ‘å€‘ä½¿ç”¨ jackson é€™å€‹ library ä¾†å¹«æˆ‘å€‘æŠŠ Java ç‰©ä»¶è½‰æˆ JSON æ ¼å¼çš„å­—ä¸²ï¼š
Map&amp;lt;String, Object&amp;gt; data = new HashMap&amp;lt;&amp;gt;(); data.put(&amp;#34;text&amp;#34;, &amp;#34;test message&amp;#34;); data.put(&amp;#34;age&amp;#34;, 23); data.put(&amp;#34;boolean&amp;#34;, true); ObjectMapper mapper = new ObjectMapper(); // writerWithDefaultPrettyPrinter() æœƒæ’ç‰ˆè¼¸å‡ºçš„çµæœ String jsonString = mapper.</description></item><item><title>H2 Database and SQL Alias Column Name</title><link>https://blackdiz.github.io/blog/sql-and-h2-db/</link><pubDate>Tue, 08 Jun 2021 07:59:46 +0800</pubDate><guid>https://blackdiz.github.io/blog/sql-and-h2-db/</guid><description>æœ‹å‹å•äº†ä¸€å€‹å¥‡å¦™çš„ç‹€æ³ï¼Œä¸‹é¢é€™å€‹ Spring JPA çš„ NativeQuery å›å‚³çš„ column name æ‡‰è©²æ˜¯ as ä¹‹å¾Œçš„åç¨± (ä»¥ä¸‹ç‚ºæ¸¬è©¦çš„ NativeQueryï¼Œéæœ‹å‹å¯¦éš›åŸ·è¡Œçš„ SQL)ï¼š
String sql = &amp;#34;select Name as Name, SeqNo as SeqNo from Test where Name = :name&amp;#34;; List&amp;lt;Tuple&amp;gt; result = entityManager.createNativeQuery(sql, Tuple.class).setParameter(&amp;#34;name&amp;#34;, name) .getResultList(); return result; ä¹Ÿå°±æ˜¯ Name å’Œ SeqNoï¼Œä½†è·‘å‡ºä¾†çš„çµæœå»æ˜¯å…¨å¤§å¯«çš„ NAME å’Œ SEQNOï¼š
è€Œä¸”æˆ‘ä½¿ç”¨ SQLServer æ¸¬è©¦æ™‚ç„¡æ³•é‡ç¾é€™å€‹ç‹€æ³ã€‚ä¸€é–‹å§‹ä»¥ç‚ºæ˜¯ä¸æ˜¯ Spring JPA çš„è¨­å®šå•é¡Œï¼Œä½† Google å¤§ç¥æ²’æœ‰é™ä»€éº¼ç¥æ—¨ï¼Œç¿»äº† Spring JPA çš„æ–‡ä»¶ä¹Ÿæ²’çœ‹åˆ°ä»€éº¼ç›¸é—œçš„è¨­å®šï¼Œæƒ³èªªåªå¥½ç”¨ debug æ¨¡å¼ä¾†è¿½è¹¤ä¸€ä¸‹åˆ°åº•åŸ·è¡Œéç¨‹ä¸­æ˜¯ä¸æ˜¯æœ‰ä»€éº¼åœ°æ–¹æœƒå»ä¿®æ”¹ alias column nameã€‚ åœ¨è¿½è¹¤çš„éç¨‹ä¸­ï¼Œçªç„¶çœ‹åˆ°é€™è¡Œï¼š
é›–ç„¶å’ŒåŸ·è¡Œéç¨‹ç„¡é—œ ğŸ˜…ï¼Œä½† factory.getJdbcServices().getDialect() è®“æˆ‘æƒ³åˆ°æœ‹å‹ç”¨çš„æ˜¯ H2 Databaseï¼Œé¦¬ä¸Šå»å®˜ç¶²æŸ¥äº†ä¸€ä¸‹ç™¼ç¾æœç„¶æ˜¯å› ç‚º H2 é è¨­å°æ–¼æ²’æœ‰ä½¿ç”¨ &amp;quot;&amp;quot; æ‹¬èµ·ä¾†çš„æ¬„ä½åç¨±éƒ½æœƒä¾è¨­å®šè½‰æˆå…¨å¤§å¯«æˆ–å…¨å°å¯«ï¼š</description></item><item><title>å¾ Server ç«¯è¼¸å‡ºä¸‹è¼‰çš„æª”åå«æœ‰ä¸­æ–‡æœƒè®Šæˆäº‚ç¢¼å•é¡Œ</title><link>https://blackdiz.github.io/blog/garbled-file-name/</link><pubDate>Mon, 22 Mar 2021 15:15:46 +0800</pubDate><guid>https://blackdiz.github.io/blog/garbled-file-name/</guid><description>å¾ Server ç«¯è¼¸å‡ºä¸‹è¼‰çš„æª”åå«æœ‰ä¸­æ–‡æœƒè®Šæˆäº‚ç¢¼å•é¡Œ æœ‹å‹é‡åˆ°ä¸€å€‹å•é¡Œæ˜¯å¦‚æœæª”åæœ‰ä¸­æ–‡ï¼Œåœ¨ç€è¦½å™¨ä¸‹è¼‰æ™‚æª”åæœƒè®Šæˆäº‚ç¢¼ã€‚
é¦–å…ˆï¼Œç€è¦½å™¨æ˜¯ç”¨ header ä¸­çš„ Content-Disposition=attachment;filename=${æª”å} åšç‚ºé è¨­çš„ä¸‹è¼‰æª”åï¼Œä½† header ä¸­ä¸¦ä¸æ”¯æ´ UTF-8 ç·¨ç¢¼ï¼Œæ‰€ä»¥å¦‚æœåœ¨ç¨‹å¼ä¸­ç›´æ¥æ‹¿ä¸­æ–‡æª”åæ”¾åœ¨ filename ä¸­å°±æœƒè®Šæˆäº‚ç¢¼ã€‚
è§£æ±ºæ–¹æ³•æ˜¯å…ˆæŠŠæª”å encode æˆ URL-encoded ç·¨ç¢¼ï¼Œåœ¨ Java ä¸­å¯ä»¥ç”¨ URLEncoder è™•ç†ï¼š
response.setHeader(&amp;#34;Content-Disposition&amp;#34;, &amp;#34;attachment;filename=&amp;#34; + URLEncoder.encode(fileName, &amp;#34;UTF-8&amp;#34;); å¦‚æœæœ‰ä»€éº¼æƒ³æ³•æˆ–éœ€è¦æŒ‡æ­£çš„åœ°æ–¹ï¼Œæ­¡è¿æ‚¨ç•™è¨€æˆ–ä¾†ä¿¡ ğŸ˜„</description></item></channel></rss>